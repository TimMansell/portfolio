'use strict';

// Some variables.
var appConfig = {
	breakpoints: {
		xs: 767,
		sm: 991,
		md: 1199
	}
};

// Init app with dependencies.
(function() {
	angular
		.module('TM', [])
  		.config(['$locationProvider', function ($locationProvider) {
  	}]);
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmCarousel', tmCarousel);

    function tmCarousel() {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var autoplay = (attrs.autoplay) ? true : false,
            speed =  (attrs.speed) ? attrs.speed : 3000;

        element.slick({
          autoplay: autoplay,
          autoplaySpeed: speed
        });        
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmCenterContent', tmCenterContent);

    function tmCenterContent() {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $window = angular.element(window),
            $container = (attrs.element) ? element.find(attrs.element) : element.children()[0];
        
        function positionContainer() {
          $container.css('top', ( ( element.height() - $container.height() - 20 ) / 2) + 'px' );
        }

        $window.on('resize', function(){ 
          positionContainer();  
        });

        // Init.
        positionContainer();
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmLazyLoad', tmLazyLoad);

    function tmLazyLoad() {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var autoplay = (attrs.autoplay) ? true : false,
            speed =  (attrs.speed) ? attrs.speed : 3000;

        element.slick({
          autoplay: autoplay,
          autoplaySpeed: speed
        });        
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmScrollFade', tmScrollFade);

    function tmScrollFade() {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $window = angular.element(window),
            opacity;

        $window.on('scroll', function(e){
          opacity = 1 - ($window.scrollTop() / $window.height()) * 1.15;

          if (opacity >= 0){
            element.css('opacity', opacity);
          }
        }) ;    
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmShuffleContent', tmShuffleContent);

    tmShuffleContent.$inject = ['$interval'];

    function tmShuffleContent($interval) {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $elements = element.children(),
            elementsArray = $elements.toArray(),
            containerHeight = element.height();

        // Set height of container.
        element.height(containerHeight);

        $interval(function(){
          $elements.hide();            
          shuffle();
        }, 4000);

        // Shuffle text.
        function shuffle(){
          angular.element(elementsArray[0]).show().shuffleLetters();

          elementsArray.push(elementsArray.shift());
        }

        // Init.
        shuffle(); 
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmNavigation', tmNavigation);

    function tmNavigation() {
      var directive = {
        link: link,
        //templateUrl: '/template/is/located/here.html',
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $window = angular.element(window);

        // Stick Navigation.
        element.stickyNavbar({
          mobileWidth: appConfig.breakpoints.xs,
          stickyModeClass: 'is-sticky'
          //startAt: 500
        });

        /*element.find('ul').onePageNav({
          scrollSpeed: 400 
        });*/

        /*$window.on('scroll', function(){
          if($window.scrollTop() < $window.height()/2) {
            element.find('li').removeClass('current');
            //element.
            //scope.
          }
        });

        $window.on('resize', function(e){ 
          console.log('e', e);
          if(e.target.innerWidth > appConfig.breakpoints.xs){

          }
        });*/
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmShuffleOnScreen', tmShuffleOnScreen);

    function tmShuffleOnScreen() {
      var directive = {
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $window = angular.element(window),
            windowHasScrolled = 0,
            elementFromScreen = 0,
            elementHasShuffled = false,
            graceFromBottom = 150;

        // Set height so element keeps it's height when text dissapears.
        element.css('height', element.height());

        // Calculate on scroll
        $window.on('scroll', function(){
          windowHasScrolled = $window.scrollTop() + $window.height();
          elementFromScreen = element.offset().top;

          // We have scrolled to the element, now do your stuff!
          if(windowHasScrolled >= (elementFromScreen + graceFromBottom) && elementHasShuffled === false){
            element.shuffleLetters();    

            // We've shuffled once so turn off.
            elementHasShuffled = !elementHasShuffled;
          }
        });
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmRandomNumbersOnScreen', tmRandomNumbersOnScreen);

    tmRandomNumbersOnScreen.$inject = ['$timeout', '$filter'];

    function tmRandomNumbersOnScreen($timeout, $filter) {
      var directive = {
        scope: {},
        link: link,
        restrict: 'EA'
      };
      return directive;

      function link(scope, element, attrs) {
        var $window = angular.element(window),
            windowHasScrolled = 0,
            elementFromScreen = 0,
            elementHasCounted = false,
            graceFromBottom = 150;

        // Set height so element keeps it's height when text dissapears.
        element.css('height', element.height());

        // Calculate on scroll
        $window.on('scroll', function(){
          windowHasScrolled = $window.scrollTop() + $window.height();
          elementFromScreen = element.offset().top;

          // We have scrolled to the element, now do your stuff!
          if(windowHasScrolled >= (elementFromScreen + graceFromBottom) && elementHasCounted === false){
            countTo();    

            // We've shuffled once so turn off.
            elementHasCounted = !elementHasCounted;
          }
        });

        //countTo();  

        function countTo(){
          var e = element[0];
            var num, refreshInterval, duration, steps, step, countTo, value, increment;

            var calculate = function () {
                refreshInterval = 30;
                step = 0;
                scope.timoutId = null;
                countTo = 5000;
                duration = 5000;
                scope.value = 0;
                //countTo = parseInt(attrs.countTo) || 0;
                //scope.value = parseInt(attrs.value, 10) || 0;
                //duration = (parseFloat(attrs.duration) * 1000) || 0;

                steps = Math.ceil(duration / refreshInterval);
                increment = ((countTo - scope.value) / steps);
                num = scope.value;
            };

            var tick = function () {
                $timeout(function () {
                  num += increment;
                  step++;
                  if (step >= steps) {
                      num = countTo;

                      e.textContent = $filter('number')(countTo, 0);
                  } else {

                      e.textContent = $filter('number')(num, 0);
                      tick();
                  }
                }, refreshInterval);

            };

            var start = function () {
                calculate();
                tick();
            };

            start();
        }
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .directive('tmPortfolio', tmPortfolio);

    function tmPortfolio() {
      var directive = {
        link: link,
        templateUrl: 'assets/templates/portfolio.html',
        restrict: 'EA',
        controller: portfolioController,
        controllerAs: 'pf',
        bindToController: true
      };
      return directive;

      function link(scope, element, attrs) {
        
      }

      portfolioController.$inject = ['$scope', 'portfolioService'];

      function portfolioController($scope, portfolioService) {
        var pf = this;
            
        pf.items = [];
         
        init();

        ////////////

        function init() {
            return portfolioService.get().then(function(data) {
                pf.items = data;

                return pf.items;
            });
        }
      }
    }
})();
(function() {
    'use strict';

    angular
        .module('TM')
        .factory('portfolioService', portfolioService);

    portfolioService.$inject = ['$http'];

    function portfolioService($http) {
	    var service = {
	        get: get
	    };

	    return service;

	    function get(){
        	return $http.get('assets/json/portfolio.json')
	            .then(success)
	            .catch(failed);

	        function success(response) {
	            return response.data;
	        }

	        function failed(error) {
	            //logger.error('XHR Failed for getAvengers.' + error.data);
	        }
	    }
	}
})();